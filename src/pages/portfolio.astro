---
import BaseLayout from '@components/layout/BaseLayout.astro';
import CategoryTabs from '@components/ui/CategoryTabs.astro';
import GalleryItem from '@components/ui/GalleryItem.astro';

// Import gallery data from fallback file
import { fallbackGalleryItems as galleryItems, categories } from '../data/portfolio-images-fallback.ts';
---

<BaseLayout
  title="Portfolio | Dečiji rođendani i portreti"
  description="Pogledajte portfolio fotografija dečijih rođendana i portreta u Beogradu. Dragana Korhner beleži važne trenutke sa profesionalnim pristupom."
  keywords="fotografije dečijih rođendana, dečiji fotograf Beograd, portfolio fotografa, portretni fotograf, profesionalne fotografije, Škljoc Foto"
>
  <!-- Hero Section -->
  <section class="py-24 mt-16 bg-white border-b border-secondary/20">
    <div class="container text-center">
      <h1 class="text-4xl md:text-5xl font-heading mb-4">Portfolio</h1>
      <p class="text-lg text-text-light">
        Kolekcija mojih omiljenih <span class="highlight">radova</span>
      </p>
    </div>
  </section>

  <!-- Portfolio Gallery -->
  <section class="py-16">
    <div class="container">
      <!-- Category Tabs -->
      <CategoryTabs categories={categories} />

      <!-- Gallery Masonry Layout -->
      <div id="gallery" class="masonry-gallery">
        {galleryItems.map((item) => (
          <GalleryItem
            src={item.src}
            alt={item.alt}
            category={item.category as 'children' | 'family' | 'social'}
            title={item.title}
            width={item.width}
            height={item.height}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- PhotoSwipe Root Element -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>
      <div class="pswp__ui pswp__ui--hidden">
        <div class="pswp__top-bar">
          <div class="pswp__counter"></div>
          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
          <button class="pswp__button pswp__button--share" title="Share"></button>
          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>
        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<!-- PhotoSwipe CSS -->
<link rel="stylesheet" href="https://unpkg.com/photoswipe@5.4.4/dist/photoswipe.css">

<!-- PhotoSwipe and Gallery Script -->
<script>
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import 'photoswipe/style.css';

  // Initialize PhotoSwipe
  document.addEventListener('DOMContentLoaded', function() {
    const lightbox = new PhotoSwipeLightbox({
      gallery: '#gallery',
      children: 'a',
      pswpModule: () => import('photoswipe')
    });

    lightbox.init();

    // Category filtering
    const categoryTabs = document.querySelectorAll('.category-tab');
    const galleryItems = document.querySelectorAll('.gallery-item');

    // Initialize: Hide items that don't match the initially active category
    const activeTab = document.querySelector('.category-tab.active');
    const initialCategory = activeTab ? activeTab.getAttribute('data-category') : 'all';

    galleryItems.forEach(item => {
      const itemCategory = item.getAttribute('data-category');
      const shouldShow = initialCategory === 'all' || itemCategory === initialCategory;

      if (!shouldShow) {
        item.classList.add('hidden');
      }
    });

    // Remove initial animations after they've played once
    setTimeout(() => {
      galleryItems.forEach(item => {
        item.style.animation = 'none';
      });
    }, 1000);

    categoryTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Update active state
        categoryTabs.forEach(t => {
          t.classList.remove('active');
          const underline = t.querySelector('.category-tab-underline');
          if (underline) {
            underline.classList.remove('w-full');
            underline.classList.add('w-0');
          }
        });

        tab.classList.add('active');
        const underline = tab.querySelector('.category-tab-underline');
        if (underline) {
          underline.classList.remove('w-0');
          underline.classList.add('w-full');
        }

        // Get category
        const category = tab.getAttribute('data-category');

        // Instant filtering with no transitions
        galleryItems.forEach((item) => {
          const itemCategory = item.getAttribute('data-category');
          const shouldShow = category === 'all' || itemCategory === category;

          if (shouldShow) {
            // Show item instantly
            item.classList.remove('hidden');
          } else {
            // Hide item instantly
            item.classList.add('hidden');
          }
        });
      });
    });
  });
</script>

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "name": "Portfolio fotografija dečijih rođendana i portreta u Beogradu",
  "description": "Galerija profesionalnih fotografija dečijih rođendana i portreta u Beogradu",
  "contentLocation": {
    "@type": "Place",
    "name": "Beograd, Srbija"
  },
  "creator": {
    "@type": "Person",
    "name": "Dragana Korhner",
    "jobTitle": "Profesionalni fotograf"
  },
  "genre": ["Dečija fotografija", "Porodična fotografija", "Društveni događaji"],
  "thumbnailUrl": "https://www.draganakorhner.com/images/photos/children/407A1856.jpg"
}
</script>